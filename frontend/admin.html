<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chocair Fresh – Debt Manager</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google API Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1 class="header__title" data-i18n="appTitle">Chocair Fresh – Debt Manager</h1>
            <div class="header__actions">
                <div style="display: inline-block; margin-right: 10px;">
                    <select id="langSelect" style="padding: 5px; border-radius: 5px;">
                        <option value="en">English</option>
                        <option value="ar">العربية</option>
                    </select>
                </div>
                <button id="connectDriveBtn" class="btn btn--secondary btn--small" style="margin-right: 10px;" data-i18n="connectDrive">Connect Drive</button>
                <button id="logoutBtn" class="btn btn--secondary btn--small" style="margin-right: 10px; border-color: #dc2626; color: #dc2626;" data-i18n="logout">Logout</button>
                <button id="addCustomerBtn" class="btn btn--primary btn--small" data-i18n="addCustomer">Add Customer</button>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Panel: Customer List -->
            <div class="customer-panel">
                <!-- Total Outstanding Debt Card -->
                <div class="debt-card">
                    <div class="debt-card__label" data-i18n="totalOutstandingDebt">Total Outstanding Debt</div>
                    <div class="debt-card__amount-container">
                        <div class="debt-card__amount" id="totalDebtAmount">******</div>
                        <button class="debt-card__toggle" id="eyeToggleBtn" aria-label="Toggle debt visibility">
                            <svg class="debt-card__icon" id="eyeIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 7C9.24 7 7 9.24 7 12C7 14.76 9.24 17 12 17C14.76 17 17 14.76 17 12C17 9.24 14.76 7 12 7ZM12 15.5C10.07 15.5 8.5 13.93 8.5 12C8.5 10.07 10.07 8.5 12 8.5C13.93 8.5 15.5 10.07 15.5 12C15.5 13.93 13.93 15.5 12 15.5ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10Z" fill="#666"/>
                                <path d="M2 2L22 22M6.5 6.5C4.01 8.99 2.5 10.5 2.5 12C2.5 15.5 6.5 19.5 12 19.5C14.5 19.5 16.5 18.5 18 17.5M17.5 17.5C19.99 15.01 21.5 13.5 21.5 12C21.5 8.5 17.5 4.5 12 4.5C9.5 4.5 7.5 5.5 6 6.5" stroke="#666" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="search">
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="search__input" 
                        data-i18n="searchPlaceholder"
                        placeholder="Search customers by name or phone..."
                        autocomplete="off"
                    >
                </div>

                <!-- Sort Control -->
                <div class="sort">
                    <select id="sortSelect" class="sort__select">
                        <option value="name_asc" data-i18n="sortAZ">Sort: A–Z</option>
                        <option value="name_desc" data-i18n="sortZA">Sort: Z–A</option>
                        <option value="balance_desc" data-i18n="sortHighest">Sort: Highest Balance</option>
                        <option value="balance_asc" data-i18n="sortLowest">Sort: Lowest Balance</option>
                    </select>
                </div>

                <!-- Customer List -->
                <div class="customer-list-container">
                    <div id="customerList" class="customer-list"></div>
                    <div id="loadingIndicator" class="loading" data-i18n="loadingCustomers">Loading customers...</div>
                    <div id="emptyState" class="empty-state" style="display: none;">
                        <p data-i18n="noCustomersFound">No customers found.</p>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Customer Details (Hidden by default, replaced by modal) -->
            <div id="detailsPanel" class="details-panel" style="display: none;">
                <!-- Legacy container kept for JS compatibility if needed, but we will use modal -->
            </div>

            <!-- Placeholder when no customer selected -->
            <div id="noSelectionPlaceholder" class="placeholder" style="display: none;">
                <p data-i18n="selectCustomer">Select a customer to view details</p>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal (Fullscreen) -->
    <div id="customerDetailsModal" class="modal modal--fullscreen">
        <div class="modal__content modal__content--fullscreen">
            <div class="modal__header">
                <h2 class="modal__title" id="modalCustomerName">Customer Name</h2>
                <div class="modal__actions">
                    <!-- Three Dot Menu -->
                    <div class="dropdown">
                        <button class="btn-icon" id="customerMenuBtn">⋮</button>
                        <div class="dropdown-content" id="customerMenuDropdown">
                            <button id="addDebtBtn" data-i18n="addDebt">Add Debt</button>
                            <button id="addPaymentBtn" data-i18n="addPayment">Add Payment</button>
                            <button id="closeBalanceBtn" data-i18n="closeBalance">Close Balance</button>
                            <button id="editCustomerBtn" data-i18n="editCustomer">Edit Customer</button>
                            <button id="downloadStatementBtn" data-i18n="generateStatement">Generate PDF Statement</button>
                            <button id="deleteCustomerBtn" class="text-danger" data-i18n="deleteCustomer">Delete Customer</button>
                            <button id="viewHistoryBtn" data-i18n="viewHistory">View Full History</button>
                        </div>
                    </div>
                    <button class="modal__close" id="closeCustomerDetailsModal" aria-label="Close">&times;</button>
                </div>
            </div>
            <div class="modal__body">
                <!-- Customer Info -->
                <div id="modalCustomerInfo" class="customer-info-card"></div>
                
                <!-- Recent Transactions -->
                <div class="transactions-preview">
                    <h3 data-i18n="recentTransactions">Recent Transactions</h3>
                    <div id="modalTransactionsList" class="transactions__list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction History Modal (Fullscreen) -->
    <div id="transactionHistoryModal" class="modal modal--fullscreen">
        <div class="modal__content modal__content--fullscreen">
            <div class="modal__header">
                <h2 class="modal__title" data-i18n="transactionHistory">Transaction History</h2>
                <button class="modal__close" id="closeHistoryModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal__body">
                <div id="fullTransactionsList" class="transactions__list"></div>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="modal">
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title" data-i18n="addCustomer">Add Customer</h2>
                <button class="modal__close" id="closeCustomerModal" aria-label="Close">&times;</button>
            </div>
            <form id="addCustomerForm" class="modal__form">
                <div class="form-group">
                    <label for="customerName" class="form-group__label" data-i18n="customerName">Customer Name *</label>
                    <input 
                        type="text" 
                        id="customerName" 
                        name="name" 
                        class="form-group__input"
                        required
                        data-i18n="enterName"
                        placeholder="Enter customer name"
                    >
                </div>
                <div class="form-group">
                    <label for="customerPhone" class="form-group__label" data-i18n="phoneNumber">Phone Number *</label>
                    <input 
                        type="tel" 
                        id="customerPhone" 
                        name="phone" 
                        class="form-group__input"
                        required
                        data-i18n="enterPhone"
                        placeholder="Enter phone number"
                    >
                </div>
                <div class="form-group">
                    <label for="customerNotes" class="form-group__label" data-i18n="notes">Notes</label>
                    <textarea 
                        id="customerNotes" 
                        name="notes" 
                        class="form-group__textarea"
                        rows="3"
                        data-i18n="optionalNotes"
                        placeholder="Optional notes about this customer..."
                    ></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" id="cancelCustomerBtn" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn--primary" data-i18n="addCustomer">Add Customer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="editCustomerModal" class="modal">
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title" data-i18n="editCustomer">Edit Customer</h2>
                <button class="modal__close" id="closeEditCustomerModal" aria-label="Close">&times;</button>
            </div>
            <form id="editCustomerForm" class="modal__form">
                <div class="form-group">
                    <label for="editCustomerName" class="form-group__label" data-i18n="customerName">Customer Name *</label>
                    <input 
                        type="text" 
                        id="editCustomerName" 
                        name="name" 
                        class="form-group__input"
                        required
                        data-i18n="enterName"
                        placeholder="Enter customer name"
                    >
                </div>
                <div class="form-group">
                    <label for="editCustomerPhone" class="form-group__label" data-i18n="phoneNumber">Phone Number *</label>
                    <input 
                        type="tel" 
                        id="editCustomerPhone" 
                        name="phone" 
                        class="form-group__input"
                        required
                        data-i18n="enterPhone"
                        placeholder="Enter phone number"
                    >
                </div>
                <div class="form-group">
                    <label for="editCustomerNotes" class="form-group__label" data-i18n="notes">Notes</label>
                    <textarea 
                        id="editCustomerNotes" 
                        name="notes" 
                        class="form-group__textarea"
                        rows="3"
                        data-i18n="optionalNotes"
                        placeholder="Optional notes about this customer..."
                    ></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" id="cancelEditCustomerBtn" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn--primary" data-i18n="save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Debt Modal -->
    <div id="addDebtModal" class="modal">
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title" data-i18n="addDebt">Add Debt</h2>
                <button class="modal__close" id="closeDebtModal" aria-label="Close">&times;</button>
            </div>
            <form id="addDebtForm" class="modal__form">
                <div class="form-group">
                    <label for="debtAmount" class="form-group__label" data-i18n="amount">Amount *</label>
                    <input 
                        type="number" 
                        id="debtAmount" 
                        name="amount" 
                        class="form-group__input"
                        step="0.01" 
                        min="0" 
                        required
                        data-i18n="enterAmount"
                        placeholder="0.00"
                    >
                </div>
                <div class="form-group">
                    <label for="debtNote" class="form-group__label" data-i18n="note">Note</label>
                    <textarea 
                        id="debtNote" 
                        name="note" 
                        class="form-group__textarea"
                        rows="3"
                        data-i18n="optionalNotes"
                        placeholder="Optional note about this debt..."
                    ></textarea>
                </div>
                <div class="form-group">
                    <label class="form-group__label" data-i18n="addInvoiceImage">Invoice Image (Optional)</label>
                    
                    <!-- Main Add Button -->
                    <button type="button" id="btn-show-invoice-options" class="btn btn--secondary btn--small" style="width: 100%; margin-bottom: 10px;" data-i18n="addInvoiceImage">
                        Add Invoice Image
                    </button>

                    <!-- Options (Hidden by default) -->
                    <div id="invoice-options" style="display: none; gap: 10px; margin-bottom: 10px;">
                        <button type="button" id="btn-upload-device" class="btn btn--secondary btn--small" style="flex: 1; background-color: #f0f0f0; color: #333;" data-i18n="uploadFromDevice">
                            Camera / Device
                        </button>
                        <button type="button" id="btn-pick-drive" class="btn btn--secondary btn--small" style="flex: 1; background-color: #f0f0f0; color: #333;" data-i18n="pickFromDrive">
                            Google Drive
                        </button>
                    </div>

                    <!-- Hidden File Input (No capture attribute to allow choice) -->
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    
                    <p id="picker-status-text" style="font-size: 13px; color: #666; margin-top: 5px;"></p>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" id="cancelDebtBtn" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn--primary" data-i18n="addDebt">Add Debt</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div id="addPaymentModal" class="modal">
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title" data-i18n="addPayment">Add Payment</h2>
                <button class="modal__close" id="closePaymentModal" aria-label="Close">&times;</button>
            </div>
            <form id="addPaymentForm" class="modal__form">
                <div class="form-group">
                    <label for="paymentAmount" class="form-group__label" data-i18n="amount">Amount *</label>
                    <input 
                        type="number" 
                        id="paymentAmount" 
                        name="amount" 
                        class="form-group__input"
                        step="0.01" 
                        min="0" 
                        required
                        data-i18n="enterAmount"
                        placeholder="0.00"
                    >
                </div>
                <div class="form-group">
                    <label for="paymentNote" class="form-group__label" data-i18n="note">Note</label>
                    <textarea 
                        id="paymentNote" 
                        name="note" 
                        class="form-group__textarea"
                        rows="3"
                        data-i18n="optionalNotes"
                        placeholder="Optional note about this payment..."
                    ></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" id="cancelPaymentBtn" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn--primary" data-i18n="addPayment">Add Payment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Transaction Confirmation Modal -->
    <div id="deleteTransactionModal" class="modal">
        <div class="modal__content">
            <div class="modal__header">
                <h2 class="modal__title" data-i18n="deleteTransaction">Delete Transaction</h2>
                <button class="modal__close" id="closeDeleteTransactionModal" aria-label="Close">&times;</button>
            </div>
            <div class="modal__body">
                <p data-i18n="confirmDeleteTransaction">Are you sure you want to delete this transaction? This action cannot be undone.</p>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn--secondary" id="cancelDeleteTransactionBtn" data-i18n="cancel">Cancel</button>
                <button type="button" class="btn btn--danger" id="confirmDeleteTransactionBtn" data-i18n="delete">Delete</button>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>
